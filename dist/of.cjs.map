{"version":3,"file":"of.cjs","sources":["../src/index.mjs"],"sourcesContent":["function of(callable, config = {}) {\n  {\n    const { args, defaults, error, retries, timeout } = new Object(config);\n    config = { args, defaults, error, retries, timeout };\n  }\n  let call;\n  switch (callable.constructor.name || Object.prototype.toString.call(callable)) {\n    case \"Promise\":\n      call = callable;\n      config.retries = 0;\n      delete config.args;\n      break;\n    case \"AsyncFunction\":\n      call = callable(...(Array.isArray(config.args) ? [...config.args] : []));\n      break;\n    case \"Function\":\n      call = new Promise((resolve, reject) => {\n        try {\n          resolve(callable(...(Array.isArray(config.args) ? [...config.args] : [])));\n        } catch (error) {\n          reject(error);\n        }\n      });\n      break;\n    case \"GeneratorFunction\":\n      call = new Promise((resolve, reject) => {\n        const gen = callable(...(Array.isArray(config.args) ? [...config.args] : []));\n        try {\n          resolve(gen.next().value);\n        } catch (error) {\n          reject(error);\n        }\n      });\n      break;\n    case \"[object Generator]\":\n      call = new Promise((resolve, reject) => {\n        try {\n          resolve(callable.next().value);\n        } catch (error) {\n          reject(error);\n        }\n      });\n      delete config.args;\n      break;\n    default:\n      call = new Promise((resolve, reject) => {\n        Promise.resolve(callable)\n          .then(resolve)\n          .catch(reject);\n      });\n      delete config.args;\n  }\n  if (config.timeout !== undefined) {\n    const timeout = Number.parseInt(config.timeout);\n    if (Number.isFinite(timeout) && timeout > 0) {\n      config.timeout = timeout > Number.MAX_SAFE_INTEGER ? Number.MAX_SAFE_INTEGER : timeout;\n    } else {\n      delete config.timeout;\n    }\n  } else {\n    delete config.timeout;\n  }\n  return (config.timeout\n    ? Promise.race([\n        Promise.resolve(call),\n        new Promise((_resolve, reject) => {\n          setTimeout(() => reject(new Error(`Timeout: ${config.timeout}ms`)));\n        }),\n      ])\n    : Promise.resolve(call)\n  )\n    .then((result) => [result, undefined])\n    .catch((error) => {\n      if (config.retries !== undefined) {\n        const retries = Number.parseInt(config.retries);\n        if (Number.isFinite(retries) && retries > 0) {\n          config.retries = retries > Number.MAX_SAFE_INTEGER ? Number.MAX_SAFE_INTEGER : retries;\n        } else {\n          delete config.retries;\n        }\n      } else {\n        delete config.retries;\n      }\n      if (config.retries) {\n        config.attempt = config.attempt === undefined ? 0 : config.attempt + 1;\n        if (config.attempt < config.retries) {\n          return of(callable, config);\n        }\n      }\n      if (error === undefined || error === null) {\n        error = new Error(\"Rejected\");\n      }\n      if (config.error instanceof Error) {\n        error = config.error;\n      } else if (typeof config.error === \"string\") {\n        error.message = config.error;\n      }\n      return [config.defaults, error];\n    });\n}\n\nexport { of };\n"],"names":["of","callable","config","args","defaults","error","retries","timeout","Object","call","constructor","name","prototype","toString","Array","isArray","Promise","resolve","reject","gen","next","value","then","catch","undefined","Number","parseInt","isFinite","MAX_SAFE_INTEGER","race","_resolve","setTimeout","Error","result","attempt","message"],"mappings":"+EAAA,SAASA,GAAGC,EAAUC,EAAS,WAErBC,KAAEA,EAAFC,SAAQA,EAARC,MAAkBA,EAAlBC,QAAyBA,EAAzBC,QAAkCA,GAAY,IAAIC,OAAON,GAC/DA,EAAS,CAAEC,KAAAA,EAAMC,SAAAA,EAAUC,MAAAA,EAAOC,QAAAA,EAASC,QAAAA,OAEzCE,SACIR,EAASS,YAAYC,MAAQH,OAAOI,UAAUC,SAASJ,KAAKR,QAC7D,UACHQ,EAAOR,EACPC,EAAOI,QAAU,SACVJ,EAAOC,eAEX,gBACHM,EAAOR,KAAaa,MAAMC,QAAQb,EAAOC,MAAQ,IAAID,EAAOC,MAAQ,cAEjE,WACHM,EAAO,IAAIO,QAAQ,CAACC,EAASC,SAEzBD,EAAQhB,KAAaa,MAAMC,QAAQb,EAAOC,MAAQ,IAAID,EAAOC,MAAQ,KACrE,MAAOE,GACPa,EAAOb,gBAIR,oBACHI,EAAO,IAAIO,QAAQ,CAACC,EAASC,WACrBC,EAAMlB,KAAaa,MAAMC,QAAQb,EAAOC,MAAQ,IAAID,EAAOC,MAAQ,QAEvEc,EAAQE,EAAIC,OAAOC,OACnB,MAAOhB,GACPa,EAAOb,gBAIR,qBACHI,EAAO,IAAIO,QAAQ,CAACC,EAASC,SAEzBD,EAAQhB,EAASmB,OAAOC,OACxB,MAAOhB,GACPa,EAAOb,aAGJH,EAAOC,mBAGdM,EAAO,IAAIO,QAAQ,CAACC,EAASC,KAC3BF,QAAQC,QAAQhB,GACbqB,KAAKL,GACLM,MAAML,YAEJhB,EAAOC,aAEKqB,IAAnBtB,EAAOK,QAAuB,OAC1BA,EAAUkB,OAAOC,SAASxB,EAAOK,SACnCkB,OAAOE,SAASpB,IAAYA,EAAU,EACxCL,EAAOK,QAAUA,EAAUkB,OAAOG,iBAAmBH,OAAOG,iBAAmBrB,SAExEL,EAAOK,oBAGTL,EAAOK,eAERL,EAAOK,QACXS,QAAQa,KAAK,CACXb,QAAQC,QAAQR,GAChB,IAAIO,QAAQ,CAACc,EAAUZ,KACrBa,WAAW,IAAMb,EAAO,IAAIc,MAAO,YAAW9B,EAAOK,mBAGzDS,QAAQC,QAAQR,IAEjBa,KAAMW,GAAW,CAACA,OAAQT,IAC1BD,MAAOlB,YACiBmB,IAAnBtB,EAAOI,QAAuB,OAC1BA,EAAUmB,OAAOC,SAASxB,EAAOI,SACnCmB,OAAOE,SAASrB,IAAYA,EAAU,EACxCJ,EAAOI,QAAUA,EAAUmB,OAAOG,iBAAmBH,OAAOG,iBAAmBtB,SAExEJ,EAAOI,oBAGTJ,EAAOI,eAEZJ,EAAOI,UACTJ,EAAOgC,aAA6BV,IAAnBtB,EAAOgC,QAAwB,EAAIhC,EAAOgC,QAAU,EACjEhC,EAAOgC,QAAUhC,EAAOI,SACnBN,GAAGC,EAAUC,IAGpBG,MAAAA,IACFA,EAAQ,IAAI2B,MAAM,aAEhB9B,EAAOG,iBAAiB2B,MAC1B3B,EAAQH,EAAOG,MACkB,iBAAjBH,EAAOG,QACvBA,EAAM8B,QAAUjC,EAAOG,OAElB,CAACH,EAAOE,SAAUC"}