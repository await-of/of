{"version":3,"file":"of.mjs","sources":["../src/index.mjs"],"sourcesContent":["function of(callable, config = {}) {\n  if (!config || Object.prototype.toString.call(config) !== \"[object Object]\") {\n    config = {};\n  }\n  let call;\n  switch (callable.constructor.name || Object.prototype.toString.call(callable)) {\n    case \"Promise\":\n      call = callable;\n      config.retries = 0;\n      break;\n    case \"AsyncFunction\":\n      call = callable(...(Array.isArray(config.args) ? [...config.args] : []));\n      break;\n    case \"GeneratorFunction\":\n      call = new Promise((resolve, reject) => {\n        const gen = callable(...(Array.isArray(config.args) ? [...config.args] : []));\n        try {\n          resolve(gen.next().value);\n        } catch (error) {\n          reject(error);\n        }\n      });\n      break;\n    case \"[object Generator]\":\n      call = new Promise((resolve, reject) => {\n        try {\n          resolve(callable.next().value);\n        } catch (error) {\n          reject(error);\n        }\n      });\n      break;\n    case \"Function\":\n      call = new Promise((resolve, reject) => {\n        try {\n          resolve(callable(...(Array.isArray(config.args) ? [...config.args] : [])));\n        } catch (error) {\n          reject(error);\n        }\n      });\n      break;\n    default:\n      call = new Promise((resolve, reject) => {\n        Promise.resolve(callable)\n          .then(resolve)\n          .catch(reject);\n      });\n    // return [\n    //   config.defaults ? config.defaults : undefined,\n    //   config.error ? config.error : new Error(\"Unknown call type\"),\n    // ];\n  }\n  {\n    const timeout = Number.parseInt(config.timeout);\n    if (Number.isFinite(timeout) && timeout > 0) {\n      config.timeout = timeout > Number.MAX_SAFE_INTEGER ? Number.MAX_SAFE_INTEGER : timeout;\n    } else {\n      config.timeout = undefined;\n    }\n  }\n  return (config.timeout\n    ? Promise.race([\n        Promise.resolve(call),\n        new Promise((_resolve, reject) => {\n          setTimeout(() => reject(new Error(`Timeout: ${config.timeout}ms`)));\n        }),\n      ])\n    : Promise.resolve(call)\n  )\n    .then((result) => [result, undefined])\n    .catch((error) => {\n      {\n        const retries = Number.parseInt(config.retries);\n        if (Number.isFinite(retries) && retries > 0) {\n          config.retries = retries > Number.MAX_SAFE_INTEGER ? Number.MAX_SAFE_INTEGER : retries;\n        } else {\n          config.retries = undefined;\n        }\n      }\n      if (config.retries) {\n        config.attempt = config.attempt === undefined ? 0 : config.attempt + 1;\n        if (config.attempt < config.retries) {\n          return of(callable, config);\n        }\n      }\n      if (error === undefined || error === null) {\n        error = new Error(\"Rejected\");\n      }\n      if (config.error instanceof Error) {\n        error = config.error;\n      } else if (typeof config.error === \"string\") {\n        error.message = config.error;\n      }\n      return [config.defaults, error];\n    });\n}\n\nexport { of };\n"],"names":["of","callable","config","call","Object","prototype","toString","constructor","name","retries","Array","isArray","args","Promise","resolve","reject","gen","next","value","error","then","catch","timeout","Number","parseInt","isFinite","MAX_SAFE_INTEGER","undefined","race","_resolve","setTimeout","Error","result","attempt","message","defaults"],"mappings":"AAAA,SAASA,GAAGC,EAAUC,EAAS,QAIzBC,SAHCD,GAAqD,oBAA3CE,OAAOC,UAAUC,SAASH,KAAKD,KAC5CA,EAAS,IAGHD,EAASM,YAAYC,MAAQJ,OAAOC,UAAUC,SAASH,KAAKF,QAC7D,UACHE,EAAOF,EACPC,EAAOO,QAAU,YAEd,gBACHN,EAAOF,KAAaS,MAAMC,QAAQT,EAAOU,MAAQ,IAAIV,EAAOU,MAAQ,cAEjE,oBACHT,EAAO,IAAIU,QAAQ,CAACC,EAASC,WACrBC,EAAMf,KAAaS,MAAMC,QAAQT,EAAOU,MAAQ,IAAIV,EAAOU,MAAQ,QAEvEE,EAAQE,EAAIC,OAAOC,OACnB,MAAOC,GACPJ,EAAOI,gBAIR,qBACHhB,EAAO,IAAIU,QAAQ,CAACC,EAASC,SAEzBD,EAAQb,EAASgB,OAAOC,OACxB,MAAOC,GACPJ,EAAOI,gBAIR,WACHhB,EAAO,IAAIU,QAAQ,CAACC,EAASC,SAEzBD,EAAQb,KAAaS,MAAMC,QAAQT,EAAOU,MAAQ,IAAIV,EAAOU,MAAQ,KACrE,MAAOO,GACPJ,EAAOI,oBAKXhB,EAAO,IAAIU,QAAQ,CAACC,EAASC,KAC3BF,QAAQC,QAAQb,GACbmB,KAAKN,GACLO,MAAMN,YAQPO,EAAUC,OAAOC,SAAStB,EAAOoB,SACnCC,OAAOE,SAASH,IAAYA,EAAU,EACxCpB,EAAOoB,QAAUA,EAAUC,OAAOG,iBAAmBH,OAAOG,iBAAmBJ,EAE/EpB,EAAOoB,aAAUK,SAGbzB,EAAOoB,QACXT,QAAQe,KAAK,CACXf,QAAQC,QAAQX,GAChB,IAAIU,QAAQ,CAACgB,EAAUd,KACrBe,WAAW,IAAMf,EAAO,IAAIgB,MAAO,YAAW7B,EAAOoB,mBAGzDT,QAAQC,QAAQX,IAEjBiB,KAAMY,GAAW,CAACA,OAAQL,IAC1BN,MAAOF,WAEEV,EAAUc,OAAOC,SAAStB,EAAOO,SACnCc,OAAOE,SAAShB,IAAYA,EAAU,EACxCP,EAAOO,QAAUA,EAAUc,OAAOG,iBAAmBH,OAAOG,iBAAmBjB,EAE/EP,EAAOO,aAAUkB,SAGjBzB,EAAOO,UACTP,EAAO+B,aAA6BN,IAAnBzB,EAAO+B,QAAwB,EAAI/B,EAAO+B,QAAU,EACjE/B,EAAO+B,QAAU/B,EAAOO,SACnBT,GAAGC,EAAUC,IAGpBiB,MAAAA,IACFA,EAAQ,IAAIY,MAAM,aAEhB7B,EAAOiB,iBAAiBY,MAC1BZ,EAAQjB,EAAOiB,MACkB,iBAAjBjB,EAAOiB,QACvBA,EAAMe,QAAUhC,EAAOiB,OAElB,CAACjB,EAAOiC,SAAUhB"}